{# inventory_app/templates/inventory/items_attention_modal_content.html #}
{# This template is for AJAX loading into a modal, so it does NOT extend base.html #}

<p class="text-muted text-center mb-4">
    Current stock and sales status for items needing attention.
    {% if search_query %}<br><span class="fw-bold">(Search results for: "{{ search_query }}")</span>{% endif %}
</p>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-light">
            <tr>
                <th scope="col">Product Name</th>
                <th scope="col">Warning</th> {# New Warning column #}
                <th scope="col" class="text-end">Current Stock</th>
                <th scope="col" class="text-end">Price</th>
                <th scope="col">Barcode</th>
                <th scope="col">Category</th>
                <th scope="col">Last Sold</th> {# New Last Sold column #}
                <th scope="col" class="text-end">Sales (Last 30 Days)</th> {# New Sales column #}
            </tr>
        </thead>
        <tbody>
            {% if items %}
                {% for item in items %}
                <tr>
                    <td>
                        <div class="text-truncate" style="max-width: 200px;" title="{{ item.name }}">
                            <strong>{{ item.name }}</strong>
                        </div>
                    </td>
                    <td>
                        {# Display the warning status #}
                        {% if item.warning_status == 'Running Low & Not Selling' %}
                            <span class="badge bg-danger">Running Low & Not Selling</span>
                        {% elif item.warning_status == 'Running Low' %}
                            <span class="badge bg-warning text-dark">Running Low</span>
                        {% elif item.warning_status == 'Not Selling' %}
                            <span class="badge bg-info">Not Selling</span> {# Using info for Not Selling for visual distinction #}
                        {% endif %}
                    </td>
                    <td class="text-end">{{ item.stock }}</td>
                    <td class="text-end">${{ item.price|floatformat:2 }}</td>
                    <td>
                        <small class="text-muted product-barcode">{{ item.barcode|default:"N/A" }}</small>
                    </td>
                    <td>{{ item.category.name|default:"N/A" }}</td>
                    <td>
                        {% if item.last_sold %}
                            {{ item.last_sold|date:"M d, Y" }}
                            {# Optional: show days since last sale for 'Not Selling' #}
                            {% if item.warning_status == 'Not Selling' or item.warning_status == 'Running Low & Not Selling' %}
                                ({{ today|timesince:item.last_sold }} ago)
                            {% endif %}
                        {% else %}
                            Never Sold
                        {% endif %}
                    </td>
                    <td class="text-end">{{ item.total_sales_last_30_days }}</td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="8" class="text-center py-4"> {# Updated colspan to 8 #}
                        {% if search_query %}
                            No products found matching "{{ search_query }}" that need attention.
                        {% else %}
                            Great! No items currently need immediate attention.
                            <br><small class="text-muted">All products are well-stocked or selling.</small>
                        {% endif %}
                    </td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>

<style>
    /* Custom CSS for fine-tuning within this modal */
    .table-responsive {
        max-height: 450px; /* Adjust as needed for scrollable content within the modal */
        overflow-y: auto;
    }

    /* Keep text-truncate for product name, but allow more width if needed by content */
    .text-truncate {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    /* Specific styling for barcode to ensure it fits without wrapping too aggressively */
    .product-barcode {
        white-space: nowrap; /* Prevent wrapping */
        overflow: hidden;    /* Hide overflow */
        text-overflow: ellipsis; /* Show ellipsis if truncated */
        max-width: 120px; /* Adjust max-width as necessary to give it more room */
        display: block; /* Important for max-width to apply correctly */
    }

    /* Increase padding for table headers and data cells for more space */
    .table th, .table td {
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
        vertical-align: middle;
    }

    /* Ensure column headers are not too compact */
    .table thead th {
        white-space: nowrap;
    }
</style>